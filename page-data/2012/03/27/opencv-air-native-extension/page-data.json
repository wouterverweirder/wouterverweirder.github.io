{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2012/03/27/opencv-air-native-extension/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://blog.aboutme.be"}},"markdownRemark":{"id":"f75d7ee1-39e4-53fb-afde-77a702a3ece0","excerpt":"In preparation of my FITC session last month, I wrote a native extension to integrate OpenCV in your AIR applications. What it does is use OpenCV in a…","html":"<p>In preparation of my FITC session last month, I wrote a native extension to integrate OpenCV in your AIR applications. What it does is use OpenCV in a multithreaded extension, to execute HAAR cascades against a bitmap you provide from ActionScript. This bitmap could be a snapshot of your webcam image, but could also be data from other sources (e.g. kinect camera snapshot?).</p>\n<p>I had quite a hard time to get OpenCV compiling &#x26; integrating it on my device, and I don’t know if it’ll work on other people’s computers. It only works on OSX, my system was OSX 10.7 (Lion). After a lot of trying, I managed to compile opencv as static libraries, and could integrate them in a native extension package.</p>\n<p>The extension ID is be.aboutme.nativeExtensions.opencv.OpenCV. It’s event based, and will execute the heavy haar detection code in a seperate thread, so your actionscript project doesn’t lock up. First of all, you’ll create an instance of the extension, add a detection listener and load a haar cascade xml file:</p>\n<div class=\"gatsby-highlight\" data-language=\"actionscript\"><pre class=\"language-actionscript\"><code class=\"language-actionscript\">openCV <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OpenCV</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nopenCV<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span>DetectionEvent<span class=\"token punctuation\">.</span><span class=\"token constant\">DETECTION_UPDATE</span><span class=\"token punctuation\">,</span> detectionUpdateHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nopenCV<span class=\"token punctuation\">.</span><span class=\"token function\">loadCascade</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/Users/wouter/haarcascades/haarcascade_frontalface_alt2.xml\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>You will also need to send bitmap data to the extension. In this example, I’m sending a bitmap snapshot of the webcam image to the extension, using the updateImage method. You can also set minimum &#x26; maximum sizes for the detection area’s, so area’s smaller then the mnimum size of larger then the maximum size are ignored. I recommend supplying a minimum size for the detection (for example: face must be at least 40×40 pixels), as this will improve performance of the application:</p>\n<div class=\"gatsby-highlight\" data-language=\"actionscript\"><pre class=\"language-actionscript\"><code class=\"language-actionscript\">bmpData<span class=\"token punctuation\">.</span><span class=\"token function\">draw</span><span class=\"token punctuation\">(</span>video<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nopenCV<span class=\"token punctuation\">.</span><span class=\"token function\">updateImage</span><span class=\"token punctuation\">(</span>bmpData<span class=\"token punctuation\">,</span> minSize<span class=\"token punctuation\">,</span> maxSize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In the event handler, you’ll get the detected area’s with the event object that is provided:</p>\n<div class=\"gatsby-highlight\" data-language=\"actionscript\"><pre class=\"language-actionscript\"><code class=\"language-actionscript\"><span class=\"token keyword\">protected</span> <span class=\"token keyword\">function</span> <span class=\"token function\">detectionUpdateHandler</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">:</span>DetectionEvent</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span><span class=\"token keyword\">void</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> <span class=\"token keyword\">each</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token keyword\">var</span> r<span class=\"token punctuation\">:</span>Rectangle <span class=\"token keyword\">in</span> event<span class=\"token punctuation\">.</span>rectangles</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//draw rectangles here</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I’ve commited everything (native, as3 code &#x26; demo) to a github repo (<a href=\"https://github.com/wouterverweirder/AIR-OpenCV-Extension\" title=\"Code on Github\">https://github.com/wouterverweirder/AIR-OpenCV-Extension</a>)</p>\n<p>Again, it’s a mac-only extension, and will need more testing if my opencv compile will run on other mac’s :-)</p>","fields":{"slug":"/2012/03/27/opencv-air-native-extension/"},"frontmatter":{"title":"OpenCV AIR Native Extension","date":"27 Mar, 2012","description":false,"tags":["air native extension","opencv"],"hasCover":true,"cover":{"publicURL":"/static/805602bed61cf53a7045318689e7a0b2/preview.jpg","childImageSharp":{"fluid":{"tracedSVG":"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='533'%20viewBox='0%200%20400%20533'%20preserveAspectRatio='none'%3e%3cpath%20d='M302%20207c-16%206-21%2025-10%2037%204%205%205%205%209-1%202-5%203-6%202-7-9-9%203-22%2012-13%204%204%204%208%201%2012l-3%202%204%206%203%206%205-5a22%2022%200%2000-23-37m-253%205l-5%202-2%202v98l2%203%203%202h97l2-3%203-3v-47l-1-49c-2-6-4-6-53-6l-46%201m52%2013c-4%202-7%205-10%2012-4%2013-11%2020-24%2024-14%206-17%2018-7%2027%204%204%207%204%2016%203%2013-2%2023%201%2032%209%208%207%2014%207%2022%203%207-4%208-15%202-23l-9-15c-2-6-3-15-1-22%203-12-9-23-21-18m-10%2031c-16%2011-2%2035%2015%2026%2010-5%2011-20%201-26-5-3-12-3-16%200m229%201c-10%208-10%2025-1%2034%2022%2020%2052-11%2032-33-4-4-5-4-9%202l-3%206%203%203c4%206%200%2014-7%2014-8%200-12-9-7-15l2-2-3-5c-4-7-4-7-7-4m-112%208v4h-4c-4%200-4%200-4%204%200%203%200%203%204%203h4v4c0%204%200%204%203%204s3%200%203-2c0-5%201-6%205-6%203%200%203%200%203-3%200-4%200-4-4-4h-4v-4c0-4%200-4-3-4s-3%200-3%204m54%2040c-2%202-2%2014%201%2016%202%202%2012%201%2013-1%202-3%201-14-1-15-2-3-11-3-13%200m63%200c-2%202-1%2015%201%2016%205%203%2014%200%2014-4%200-3-4-3-4%200-1%204-7%202-8-2-1-7%200-9%204-9%203%200%204%200%204%202l2%201c2%200%203-1%201-4-1-3-11-3-14%200m16-1l3%2010c2%207%203%208%206%208a421%20421%200%20007-18c-2-1-3%201-5%207l-3%207-2-7-4-8-2%201m-77%203v7c0%204%201%205%204%205l5-1c1-1%202-7%200-10%200-2-8-3-9-1m21%202h-3c-2%200-2%200-2%209l1%2010c1%200%202-2%202-5l1-2h7c4-6-1-15-6-12m12%200c-5%202-3%2012%203%2013%204%200%209-3%206-4l-4%201c-1%202-4%201-4-1s1-2%205-2%204%200%204-3c-2-4-5-6-10-4'%20fill='%23d3d3d3'%20fill-rule='evenodd'/%3e%3c/svg%3e","aspectRatio":0.7493606138107417,"src":"/static/805602bed61cf53a7045318689e7a0b2/d6678/preview.jpg","srcSet":"/static/805602bed61cf53a7045318689e7a0b2/40917/preview.jpg 293w,\n/static/805602bed61cf53a7045318689e7a0b2/3c0b6/preview.jpg 585w,\n/static/805602bed61cf53a7045318689e7a0b2/d6678/preview.jpg 690w","srcWebp":"/static/805602bed61cf53a7045318689e7a0b2/f3dc3/preview.webp","srcSetWebp":"/static/805602bed61cf53a7045318689e7a0b2/05ceb/preview.webp 293w,\n/static/805602bed61cf53a7045318689e7a0b2/5c538/preview.webp 585w,\n/static/805602bed61cf53a7045318689e7a0b2/f3dc3/preview.webp 690w","sizes":"(max-width: 690px) 100vw, 690px"}}}}},"allMarkdownRemark":{"edges":[{"node":{"fields":{"slug":"/2012/04/19/air-native-extension-for-simple-speech-recognition-on-osx/"},"frontmatter":{"title":"AIR Native extension for simple speech recognition on OSX","tags":["air native extension","nsspeechrecognizer","OSX","speech recognition"],"cover":{"publicURL":"/static/5d435ebcd0e95724ae62f6a0ad19d846/preview.jpg","childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHWm0FRxP/EABgQAQEBAQEAAAAAAAAAAAAAAAIBAxIi/9oACAEBAAEFAlp7004ma7PMtQLhkM//xAAVEQEBAAAAAAAAAAAAAAAAAAAAAf/aAAgBAwEBPwGK/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGRABAQEAAwAAAAAAAAAAAAAAEQEAAhKR/9oACAEBAAY/Aup7oRyGTHKS4kN//8QAGBABAQEBAQAAAAAAAAAAAAAAAREAIVH/2gAIAQEAAT8hjDr3jMjoY3kz0UqTNwF0g09NEIeG/9oADAMBAAIAAwAAABCL3//EABYRAQEBAAAAAAAAAAAAAAAAAAERAP/aAAgBAwEBPxBg1LkLTf/EABYRAQEBAAAAAAAAAAAAAAAAAAABMf/aAAgBAgEBPxC4j//EABwQAQEAAgIDAAAAAAAAAAAAAAERACExQVFhwf/aAAgBAQABPxBnNHZHF+5ckWhgCr746xDEN26Zd41WSV3rCySoWB84PEVYZ//Z","aspectRatio":1.6901408450704225,"src":"/static/5d435ebcd0e95724ae62f6a0ad19d846/9da5a/preview.jpg","srcSet":"/static/5d435ebcd0e95724ae62f6a0ad19d846/6e6c3/preview.jpg 120w,\n/static/5d435ebcd0e95724ae62f6a0ad19d846/ef489/preview.jpg 240w,\n/static/5d435ebcd0e95724ae62f6a0ad19d846/9da5a/preview.jpg 480w,\n/static/5d435ebcd0e95724ae62f6a0ad19d846/9f916/preview.jpg 690w","srcWebp":"/static/5d435ebcd0e95724ae62f6a0ad19d846/1f47d/preview.webp","srcSetWebp":"/static/5d435ebcd0e95724ae62f6a0ad19d846/504a6/preview.webp 120w,\n/static/5d435ebcd0e95724ae62f6a0ad19d846/36764/preview.webp 240w,\n/static/5d435ebcd0e95724ae62f6a0ad19d846/1f47d/preview.webp 480w,\n/static/5d435ebcd0e95724ae62f6a0ad19d846/26a56/preview.webp 690w","sizes":"(max-width: 480px) 100vw, 480px"}}}}}},{"node":{"fields":{"slug":"/2012/02/29/fitc-amsterdam-slides-demo-videos-of-opencv-finger-tracking-air-native-extensions/"},"frontmatter":{"title":"FITC Amsterdam – slides & demo videos of opencv & finger tracking air native extensions","tags":["AIR","air native extension","airkinect","finger tracking","fitc","fitc amsterdam 2012","opencv"],"cover":{"publicURL":"/static/c54a46e8e74c3f7aa8d408c94b6f1640/preview.jpg","childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHZSsCown//xAAYEAADAQEAAAAAAAAAAAAAAAAAAQIREP/aAAgBAQABBQIT2uROM//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABcQAAMBAAAAAAAAAAAAAAAAAAABECH/2gAIAQEABj8CGsrn/8QAGRAAAwEBAQAAAAAAAAAAAAAAAAERMVEQ/9oACAEBAAE/IYPYJJx6QlEau+f/2gAMAwEAAgADAAAAEIw//8QAFhEBAQEAAAAAAAAAAAAAAAAAEQEQ/9oACAEDAQE/EIGf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhABAQEBAAMAAAAAAAAAAAAAAQARMSFB4f/aAAgBAQABPxAhaB4aLGYGPuSR0p5PHfk9v//Z","aspectRatio":1.6901408450704225,"src":"/static/c54a46e8e74c3f7aa8d408c94b6f1640/9da5a/preview.jpg","srcSet":"/static/c54a46e8e74c3f7aa8d408c94b6f1640/6e6c3/preview.jpg 120w,\n/static/c54a46e8e74c3f7aa8d408c94b6f1640/ef489/preview.jpg 240w,\n/static/c54a46e8e74c3f7aa8d408c94b6f1640/9da5a/preview.jpg 480w,\n/static/c54a46e8e74c3f7aa8d408c94b6f1640/9f916/preview.jpg 690w","srcWebp":"/static/c54a46e8e74c3f7aa8d408c94b6f1640/1f47d/preview.webp","srcSetWebp":"/static/c54a46e8e74c3f7aa8d408c94b6f1640/504a6/preview.webp 120w,\n/static/c54a46e8e74c3f7aa8d408c94b6f1640/36764/preview.webp 240w,\n/static/c54a46e8e74c3f7aa8d408c94b6f1640/1f47d/preview.webp 480w,\n/static/c54a46e8e74c3f7aa8d408c94b6f1640/26a56/preview.webp 690w","sizes":"(max-width: 480px) 100vw, 480px"}}}}}}]}},"pageContext":{"slug":"/2012/03/27/opencv-air-native-extension/","previous":{"fields":{"slug":"/2012/02/29/fitc-amsterdam-slides-demo-videos-of-opencv-finger-tracking-air-native-extensions/"},"frontmatter":{"title":"FITC Amsterdam – slides & demo videos of opencv & finger tracking air native extensions","tags":["AIR","air native extension","airkinect","finger tracking","fitc","fitc amsterdam 2012","opencv"]}},"next":{"fields":{"slug":"/2012/04/19/air-native-extension-for-simple-speech-recognition-on-osx/"},"frontmatter":{"title":"AIR Native extension for simple speech recognition on OSX","tags":["air native extension","nsspeechrecognizer","OSX","speech recognition"]}},"tag":["air native extension","opencv"]}}}
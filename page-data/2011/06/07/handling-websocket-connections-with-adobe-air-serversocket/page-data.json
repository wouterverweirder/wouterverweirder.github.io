{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/2011/06/07/handling-websocket-connections-with-adobe-air-serversocket/","result":{"data":{"site":{"siteMetadata":{"siteUrl":"https://blog.aboutme.be"}},"markdownRemark":{"id":"2e39e008-b60e-5f23-9f87-142f69e5697a","excerpt":"Since Adobe AIR 2.0, you can create your own socket-servers, using the flash.net.ServerSocket class. This makes it easy to hook external applications to your…","html":"<p>Since Adobe AIR 2.0, you can create your own socket-servers, using the flash.net.ServerSocket class. This makes it easy to hook external applications to your AIR applications, for example to create a game (server) with multiple devices as game controllers (socket clients).</p>\n<!--more-->\n<p>With an adobe air serversocket, most of the time, the clients will be other flash-based applications (swfs or native apps built with Adobe AIR). HTML5 introduced the concept of websockets: a way to create your own socket connections from an html page (using javascript) to a server. You’ll need to implement the right protocol to handle these connections, but with some work, you’re able to create an html/js mobile controller for an Adobe AIR application. Big advantage here is you don’t need to install a native application, you can just surf to a url, and start sending data between your client and your server.</p>\n<p><strong>Server side</strong></p>\n<p>First of all, I’ll go through the code on the server. I assume you’ve created an Adobe AIR 2.0 (or higher) project in your AS editor of choice. First of all, you’ll need to create an instance of the ServerSocket class and hook up some event listeners:</p>\n<div class=\"gatsby-highlight\" data-language=\"actionscript\"><pre class=\"language-actionscript\"><code class=\"language-actionscript\">serverSocket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ServerSocket</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nserverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span>ServerSocketConnectEvent<span class=\"token punctuation\">.</span><span class=\"token constant\">CONNECT</span><span class=\"token punctuation\">,</span> clientConnectHandler<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">serverSocket</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token number\">1235</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nserverSocket<span class=\"token punctuation\">.</span><span class=\"token function\">listen</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Whenever a client connects, I create an instance of an own-written client handler class, which will manage the connected client. I manage all clienthandlers in a global clientHandlers array.</p>\n<div class=\"gatsby-highlight\" data-language=\"actionscript\"><pre class=\"language-actionscript\"><code class=\"language-actionscript\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">function</span> <span class=\"token function\">clientConnectHandler</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">:</span>ServerSocketConnectEvent</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span><span class=\"token keyword\">void</span>\n<span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">var</span> clientHandler<span class=\"token punctuation\">:</span>ClientHandler <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ClientHandler</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>socket<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   clientHandler<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span>Event<span class=\"token punctuation\">.</span><span class=\"token constant\">CLOSE</span><span class=\"token punctuation\">,</span> clientHandlerCloseHandler<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   clientHandlers<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>clientHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The clienthandler instances, manage all communication between the server and the client. This is where some of the websocket-specific stuff comes in: the first message the server receives, is a handshake. We’ll need to send back a specific message to the client, otherwise the client will drop the connection with the server. <a href=\"http://en.wikipedia.org/wiki/WebSockets\">Read more about websockets and this handshake mechanism on wikipedia.</a></p>\n<p>We listen for data in this clientHandler class:</p>\n<div class=\"gatsby-highlight\" data-language=\"actionscript\"><pre class=\"language-actionscript\"><code class=\"language-actionscript\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">ClientHandler</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">socket<span class=\"token punctuation\">:</span>Socket</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>socket <span class=\"token operator\">=</span> socket<span class=\"token punctuation\">;</span>\n   socket<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span>ProgressEvent<span class=\"token punctuation\">.</span><span class=\"token constant\">SOCKET_DATA</span><span class=\"token punctuation\">,</span> socketDataHandler<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And inside this socketDataHandler, we’ll find the handshake logic:</p>\n<div class=\"gatsby-highlight\" data-language=\"actionscript\"><pre class=\"language-actionscript\"><code class=\"language-actionscript\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">function</span> <span class=\"token function\">socketDataHandler</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">:</span>ProgressEvent</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span><span class=\"token keyword\">void</span>\n<span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>socket<span class=\"token punctuation\">.</span>bytesAvailable <span class=\"token operator\">></span> <span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>firstRequestProcessed<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">{</span>\n         firstRequestProcessed <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n         <span class=\"token keyword\">var</span> message<span class=\"token punctuation\">:</span>String <span class=\"token operator\">=</span> socketBytes<span class=\"token punctuation\">.</span><span class=\"token function\">readUTFBytes</span><span class=\"token punctuation\">(</span>socketBytes<span class=\"token punctuation\">.</span>bytesAvailable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n         <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"GET \"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token punctuation\">)</span>\n         <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">var</span> messageLines<span class=\"token punctuation\">:</span>Array <span class=\"token operator\">=</span> message<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">var</span> fields<span class=\"token punctuation\">:</span>Object <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">var</span> requestedURL<span class=\"token punctuation\">:</span>String <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i<span class=\"token punctuation\">:</span>uint <span class=\"token operator\">=</span> <span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> messageLines<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n               <span class=\"token keyword\">var</span> line<span class=\"token punctuation\">:</span>String <span class=\"token operator\">=</span> messageLines<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n               <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">==</span> <span class=\"token punctuation\">)</span>\n               <span class=\"token punctuation\">{</span>\n                  <span class=\"token keyword\">var</span> getSplit<span class=\"token punctuation\">:</span>Array <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>getSplit<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">{</span>\n                     requestedURL <span class=\"token operator\">=</span> getSplit<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token punctuation\">}</span>\n               <span class=\"token punctuation\">}</span>\n               <span class=\"token keyword\">else</span>\n               <span class=\"token punctuation\">{</span>\n                  <span class=\"token keyword\">var</span> index<span class=\"token punctuation\">:</span>int <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\":\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>index <span class=\"token operator\">></span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">{</span>\n                     <span class=\"token keyword\">var</span> key<span class=\"token punctuation\">:</span>String <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                     fields<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> line<span class=\"token punctuation\">.</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span>index <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span> <span class=\"token regex\">/^([\\s|\\t|\\n]+)?(.*)([\\s|\\t|\\n]+)?$/gm</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"$2\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token punctuation\">}</span>\n               <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token comment\">//check the websocket version</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>fields<span class=\"token punctuation\">[</span><span class=\"token string\">\"Sec-WebSocket-Version\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">{</span>\n               <span class=\"token comment\">//NOT SUPPORTED YET</span>\n            <span class=\"token punctuation\">}</span>\n            <span class=\"token keyword\">else</span>\n            <span class=\"token punctuation\">{</span>\n               <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>fields<span class=\"token punctuation\">[</span><span class=\"token string\">\"Sec-WebSocket-Key1\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> fields<span class=\"token punctuation\">[</span><span class=\"token string\">\"Sec-WebSocket-Key2\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\n               <span class=\"token punctuation\">{</span>\n                  <span class=\"token comment\">//draft-ietf-hybi-thewebsocketprotocol-00</span>\n                  <span class=\"token comment\">//send a response</span>\n                  <span class=\"token keyword\">var</span> result<span class=\"token punctuation\">:</span><span class=\"token operator\">*</span> <span class=\"token operator\">=</span> fields<span class=\"token punctuation\">[</span><span class=\"token string\">\"Sec-WebSocket-Key1\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/[-9]/gi</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token keyword\">var</span> key1Nr<span class=\"token punctuation\">:</span>uint <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>result <span class=\"token keyword\">is</span> Array<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">uint</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n                  result <span class=\"token operator\">=</span> fields<span class=\"token punctuation\">[</span><span class=\"token string\">\"Sec-WebSocket-Key1\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/ /gi</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token keyword\">var</span> key1SpaceCount<span class=\"token punctuation\">:</span>uint <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>result <span class=\"token keyword\">is</span> Array<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> result<span class=\"token punctuation\">.</span>length <span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token keyword\">var</span> key1Part<span class=\"token punctuation\">:</span>Number <span class=\"token operator\">=</span> key1Nr <span class=\"token operator\">/</span> key1SpaceCount<span class=\"token punctuation\">;</span>\n \n                  result <span class=\"token operator\">=</span> fields<span class=\"token punctuation\">[</span><span class=\"token string\">\"Sec-WebSocket-Key2\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/[-9]/gi</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token keyword\">var</span> key2Nr<span class=\"token punctuation\">:</span>uint <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>result <span class=\"token keyword\">is</span> Array<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">uint</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n                  result <span class=\"token operator\">=</span> fields<span class=\"token punctuation\">[</span><span class=\"token string\">\"Sec-WebSocket-Key2\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/ /gi</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token keyword\">var</span> key2SpaceCount<span class=\"token punctuation\">:</span>uint <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>result <span class=\"token keyword\">is</span> Array<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> result<span class=\"token punctuation\">.</span>length <span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token keyword\">var</span> key2Part<span class=\"token punctuation\">:</span>Number <span class=\"token operator\">=</span> key2Nr <span class=\"token operator\">/</span> key2SpaceCount<span class=\"token punctuation\">;</span>\n \n                  <span class=\"token comment\">//calculate binary md5 hash</span>\n                  <span class=\"token keyword\">var</span> bytesToHash<span class=\"token punctuation\">:</span>ByteArray <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ByteArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  bytesToHash<span class=\"token punctuation\">.</span><span class=\"token function\">writeUnsignedInt</span><span class=\"token punctuation\">(</span>key1Part<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  bytesToHash<span class=\"token punctuation\">.</span><span class=\"token function\">writeUnsignedInt</span><span class=\"token punctuation\">(</span>key2Part<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  bytesToHash<span class=\"token punctuation\">.</span><span class=\"token function\">writeBytes</span><span class=\"token punctuation\">(</span>socketBytes<span class=\"token punctuation\">,</span> socketBytes<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \n                  <span class=\"token comment\">//hash it</span>\n                  <span class=\"token keyword\">var</span> hash<span class=\"token punctuation\">:</span>String <span class=\"token operator\">=</span> <span class=\"token constant\">MD5</span><span class=\"token punctuation\">.</span><span class=\"token function\">hashBytes</span><span class=\"token punctuation\">(</span>bytesToHash<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \n                  <span class=\"token keyword\">var</span> response<span class=\"token punctuation\">:</span>String <span class=\"token operator\">=</span> <span class=\"token string\">\"HTTP/1.1 101 WebSocket Protocol Handshake\\r\\n\"</span> <span class=\"token operator\">+</span>\n                     <span class=\"token string\">\"Upgrade: WebSocket\\r\\n\"</span> <span class=\"token operator\">+</span>\n                     <span class=\"token string\">\"Connection: Upgrade\\r\\n\"</span> <span class=\"token operator\">+</span>\n                     <span class=\"token string\">\"Sec-WebSocket-Origin: \"</span> <span class=\"token operator\">+</span> fields<span class=\"token punctuation\">[</span><span class=\"token string\">\"Origin\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token string\">\"\\r\\n\"</span> <span class=\"token operator\">+</span>\n                     <span class=\"token string\">\"Sec-WebSocket-Location: ws://\"</span> <span class=\"token operator\">+</span> fields<span class=\"token punctuation\">[</span><span class=\"token string\">\"Host\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> requestedURL <span class=\"token operator\">+</span> <span class=\"token string\">\"\\r\\n\"</span> <span class=\"token operator\">+</span>\n                     <span class=\"token string\">\"\\r\\n\"</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token keyword\">var</span> responseBytes<span class=\"token punctuation\">:</span>ByteArray <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ByteArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  responseBytes<span class=\"token punctuation\">.</span><span class=\"token function\">writeUTFBytes</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n \n                  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>i <span class=\"token operator\">=</span> <span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> hash<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> i <span class=\"token operator\">+=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n                  <span class=\"token punctuation\">{</span>\n                     responseBytes<span class=\"token punctuation\">.</span><span class=\"token function\">writeByte</span><span class=\"token punctuation\">(</span><span class=\"token function\">parseInt</span><span class=\"token punctuation\">(</span>hash<span class=\"token punctuation\">.</span><span class=\"token function\">substr</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token punctuation\">}</span>\n \n                  responseBytes<span class=\"token punctuation\">.</span><span class=\"token function\">writeByte</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  responseBytes<span class=\"token punctuation\">.</span>position <span class=\"token operator\">=</span> <span class=\"token punctuation\">;</span>\n                  socket<span class=\"token punctuation\">.</span><span class=\"token function\">writeBytes</span><span class=\"token punctuation\">(</span>responseBytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  socket<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token comment\">//stop right here</span>\n                  socketBytes<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                  <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n               <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n         <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">else</span>\n      <span class=\"token punctuation\">{</span>\n         <span class=\"token comment\">//do something else with the data</span>\n      <span class=\"token punctuation\">}</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This will accept a websocket connection and send back the correct handshake. So, how do you connect from html / javascript to this AIR server?</p>\n<p><strong>HTML5 Websocket client</strong></p>\n<p>You’ll connect to the AIR server using javascript. This is pretty straightforward: you create a WebSocket object, link the correct event handlers and connect to the air server on the correct port:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">try</span>\n   <span class=\"token punctuation\">{</span>\n      socket <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">WebSocket</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"ws://localhost:1235\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      socket<span class=\"token punctuation\">.</span>onopen <span class=\"token operator\">=</span> socketOpenHandler<span class=\"token punctuation\">;</span>\n      socket<span class=\"token punctuation\">.</span>onmessage <span class=\"token operator\">=</span> socketMessageHandler<span class=\"token punctuation\">;</span>\n      socket<span class=\"token punctuation\">.</span>onclose <span class=\"token operator\">=</span> socketCloseHandler<span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n   <span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>exception<span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error: \"</span> <span class=\"token operator\">+</span> exception<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n \n<span class=\"token keyword\">function</span> <span class=\"token function\">socketOpenHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n   <span class=\"token comment\">//connected to the server</span>\n<span class=\"token punctuation\">}</span>\n \n<span class=\"token keyword\">function</span> <span class=\"token function\">socketMessageHandler</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">message</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n   <span class=\"token comment\">//message received: message.data</span>\n<span class=\"token punctuation\">}</span>\n \n<span class=\"token keyword\">function</span> <span class=\"token function\">socketCloseHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n   <span class=\"token comment\">//connection closed</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>That’s it. Fire up your Adobe AIR server, and you should be able to connect to the Adobe AIR application from javascript!</p>\n<p><del datetime=\"2011-11-24T19:35:43+00:00\">I’ll post some examples &#x26; a utility library in a follow-up post, so stay tuned :-)</del></p>\n<p>Update: Check <a href=\"/2011/11/24/airserver-support-for-websocket-version-8/\">/2011/11/24/airserver-support-for-websocket-version-8/</a> for a library and demos.</p>","fields":{"slug":"/2011/06/07/handling-websocket-connections-with-adobe-air-serversocket/"},"frontmatter":{"title":"Handling websocket connections with Adobe AIR ServerSocket","date":"07 Jun, 2011","description":false,"tags":["Actionscript 3.0","AIR","html5"],"hasCover":true,"cover":{"publicURL":"/static/4ef73287f0cfa51151976ae00d567265/preview.jpg","childImageSharp":{"fluid":{"tracedSVG":"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='533'%20viewBox='0%200%20400%20533'%20preserveAspectRatio='none'%3e%3cpath%20d='M183%20119c-35%200-39%201-41%202-4%203-5%206-5%2012l-1%205h-1l1%201v3l1%2046a381%20381%200%20010%2050l4%205%203%203h113l3-4%203-4v-55a366%20366%200%2000-3-62h-2c-3-2-28-3-75-2m22%2017c-4%203-8%207-10%2013-4%2014-15%2025-29%2029s-19%2022-8%2032c5%204%2010%205%2019%203%2015-2%2026%201%2039%2011%209%207%2018%208%2025%202%209-8%209-18%200-29-8-10-12-20-10-32%201-16%201-19-3-24-5-7-16-9-23-5m-8%2035c-7%203-11%2011-10%2019%203%2016%2026%2020%2033%205%208-15-8-31-23-24m0%20105c0%203%200%203-4%203s-4%200-4%204c0%203%200%203%204%203h4v4c0%204%200%204%203%204s3%200%203-4v-4h4c4%200%204%200%204-3%200-4%200-4-4-4s-4%200-4-3c0-4%200-4-3-4s-3%200-3%204m-64%2039l8%208%209%209%2010-1%2013%201h4l2-1%201%201h4l1%201v1l7%205%204%205-8%209-9%208-6-6c-6-6-7-7-7-11v-4h-17v16l14%2015%2015%2014-6%206-5%206%209%2010%2010%2010h41l40-1-7-9-8-8h-60l-6-7-7-7%203-2%203-3%206%205%206%206h23l-11-12-12-12%203-3%203-2%2012%2011%2011%2012v-25l-5-5-6-5%203-3%202-3%208%207%207%208v32h17v-40l-9-10c-8-7-10-9-12-8l-2%201-4%206-4%203-6-5c-3-4-6-7-5-8h-1l-9-8-9-8h-29l-29%201'%20fill='%23d3d3d3'%20fill-rule='evenodd'/%3e%3c/svg%3e","aspectRatio":0.7493606138107417,"src":"/static/4ef73287f0cfa51151976ae00d567265/d6678/preview.jpg","srcSet":"/static/4ef73287f0cfa51151976ae00d567265/40917/preview.jpg 293w,\n/static/4ef73287f0cfa51151976ae00d567265/3c0b6/preview.jpg 585w,\n/static/4ef73287f0cfa51151976ae00d567265/d6678/preview.jpg 690w","srcWebp":"/static/4ef73287f0cfa51151976ae00d567265/f3dc3/preview.webp","srcSetWebp":"/static/4ef73287f0cfa51151976ae00d567265/05ceb/preview.webp 293w,\n/static/4ef73287f0cfa51151976ae00d567265/5c538/preview.webp 585w,\n/static/4ef73287f0cfa51151976ae00d567265/f3dc3/preview.webp 690w","sizes":"(max-width: 690px) 100vw, 690px"}}}}},"allMarkdownRemark":{"edges":[{"node":{"fields":{"slug":"/2012/02/29/fitc-amsterdam-slides-demo-videos-of-opencv-finger-tracking-air-native-extensions/"},"frontmatter":{"title":"FITC Amsterdam – slides & demo videos of opencv & finger tracking air native extensions","tags":["AIR","air native extension","airkinect","finger tracking","fitc","fitc amsterdam 2012","opencv"],"cover":{"publicURL":"/static/c54a46e8e74c3f7aa8d408c94b6f1640/preview.jpg","childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHZSsCown//xAAYEAADAQEAAAAAAAAAAAAAAAAAAQIREP/aAAgBAQABBQIT2uROM//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABcQAAMBAAAAAAAAAAAAAAAAAAABECH/2gAIAQEABj8CGsrn/8QAGRAAAwEBAQAAAAAAAAAAAAAAAAERMVEQ/9oACAEBAAE/IYPYJJx6QlEau+f/2gAMAwEAAgADAAAAEIw//8QAFhEBAQEAAAAAAAAAAAAAAAAAEQEQ/9oACAEDAQE/EIGf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhABAQEBAAMAAAAAAAAAAAAAAQARMSFB4f/aAAgBAQABPxAhaB4aLGYGPuSR0p5PHfk9v//Z","aspectRatio":1.6901408450704225,"src":"/static/c54a46e8e74c3f7aa8d408c94b6f1640/9da5a/preview.jpg","srcSet":"/static/c54a46e8e74c3f7aa8d408c94b6f1640/6e6c3/preview.jpg 120w,\n/static/c54a46e8e74c3f7aa8d408c94b6f1640/ef489/preview.jpg 240w,\n/static/c54a46e8e74c3f7aa8d408c94b6f1640/9da5a/preview.jpg 480w,\n/static/c54a46e8e74c3f7aa8d408c94b6f1640/9f916/preview.jpg 690w","srcWebp":"/static/c54a46e8e74c3f7aa8d408c94b6f1640/1f47d/preview.webp","srcSetWebp":"/static/c54a46e8e74c3f7aa8d408c94b6f1640/504a6/preview.webp 120w,\n/static/c54a46e8e74c3f7aa8d408c94b6f1640/36764/preview.webp 240w,\n/static/c54a46e8e74c3f7aa8d408c94b6f1640/1f47d/preview.webp 480w,\n/static/c54a46e8e74c3f7aa8d408c94b6f1640/26a56/preview.webp 690w","sizes":"(max-width: 480px) 100vw, 480px"}}}}}},{"node":{"fields":{"slug":"/2012/01/13/access-the-mac-sudden-motion-sensor-with-an-air-native-extension/"},"frontmatter":{"title":"Access the mac sudden motion sensor with an AIR native extension","tags":["accelerometer","AIR","native extension","OSX","sudden motion sensor"],"cover":{"publicURL":"/static/eacb22b7ae25c87ddca89cb5fee3052d/preview.jpg","childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEAgX/xAAUAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHuz0qF5gT/xAAZEAADAQEBAAAAAAAAAAAAAAABAgMAEBH/2gAIAQEAAQUCY+CVS7Y5ZonP/8QAFhEBAQEAAAAAAAAAAAAAAAAAEQEQ/9oACAEDAQE/AWGf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGhABAAIDAQAAAAAAAAAAAAAAARARAAIhIv/aAAgBAQAGPwJcpK5PnUI//8QAGxAAAgMAAwAAAAAAAAAAAAAAAREAEDFRYXH/2gAIAQEAAT8h6MDnJGbQMI5DD8kV/9oADAMBAAIAAwAAABAMz//EABYRAQEBAAAAAAAAAAAAAAAAAAEQIf/aAAgBAwEBPxABCbP/xAAWEQEBAQAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8QR2f/xAAbEAEBAAMAAwAAAAAAAAAAAAABEQAhMRBBUf/aAAgBAQABPxD2beL2FyAtqxMRCWR0jrwTgKER4mWRkjq1iv1z/9k=","aspectRatio":1.6901408450704225,"src":"/static/eacb22b7ae25c87ddca89cb5fee3052d/9da5a/preview.jpg","srcSet":"/static/eacb22b7ae25c87ddca89cb5fee3052d/6e6c3/preview.jpg 120w,\n/static/eacb22b7ae25c87ddca89cb5fee3052d/ef489/preview.jpg 240w,\n/static/eacb22b7ae25c87ddca89cb5fee3052d/9da5a/preview.jpg 480w,\n/static/eacb22b7ae25c87ddca89cb5fee3052d/9f916/preview.jpg 690w","srcWebp":"/static/eacb22b7ae25c87ddca89cb5fee3052d/1f47d/preview.webp","srcSetWebp":"/static/eacb22b7ae25c87ddca89cb5fee3052d/504a6/preview.webp 120w,\n/static/eacb22b7ae25c87ddca89cb5fee3052d/36764/preview.webp 240w,\n/static/eacb22b7ae25c87ddca89cb5fee3052d/1f47d/preview.webp 480w,\n/static/eacb22b7ae25c87ddca89cb5fee3052d/26a56/preview.webp 690w","sizes":"(max-width: 480px) 100vw, 480px"}}}}}},{"node":{"fields":{"slug":"/2012/01/07/accessing-the-kinect-in-javascript-through-websockets/"},"frontmatter":{"title":"Accessing the kinect in javascript through websockets","tags":["AIR","airkinect","AIRServer","as3nui","canvas","html5","js","kinect","threejs"],"cover":{"publicURL":"/static/283803d2c53ef9765825374d2c3a8366/preview.jpg","childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAECAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHcjcCGH//EABYQAQEBAAAAAAAAAAAAAAAAAAEQMf/aAAgBAQABBQJhl//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABYQAAMAAAAAAAAAAAAAAAAAAAAgQf/aAAgBAQAGPwIq/wD/xAAcEAABAwUAAAAAAAAAAAAAAAAAARGRICExQWH/2gAIAQEAAT8htXcD8gYKP//aAAwDAQACAAMAAAAQgA//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAEAAgIDAAAAAAAAAAAAAAABABEgIUFR0f/aAAgBAQABPxB06VnCYE9M0s6w/9k=","aspectRatio":1.6901408450704225,"src":"/static/283803d2c53ef9765825374d2c3a8366/9da5a/preview.jpg","srcSet":"/static/283803d2c53ef9765825374d2c3a8366/6e6c3/preview.jpg 120w,\n/static/283803d2c53ef9765825374d2c3a8366/ef489/preview.jpg 240w,\n/static/283803d2c53ef9765825374d2c3a8366/9da5a/preview.jpg 480w,\n/static/283803d2c53ef9765825374d2c3a8366/9f916/preview.jpg 690w","srcWebp":"/static/283803d2c53ef9765825374d2c3a8366/1f47d/preview.webp","srcSetWebp":"/static/283803d2c53ef9765825374d2c3a8366/504a6/preview.webp 120w,\n/static/283803d2c53ef9765825374d2c3a8366/36764/preview.webp 240w,\n/static/283803d2c53ef9765825374d2c3a8366/1f47d/preview.webp 480w,\n/static/283803d2c53ef9765825374d2c3a8366/26a56/preview.webp 690w","sizes":"(max-width: 480px) 100vw, 480px"}}}}}}]}},"pageContext":{"slug":"/2011/06/07/handling-websocket-connections-with-adobe-air-serversocket/","previous":{"fields":{"slug":"/2011/03/07/as3osceleton-using-kinect-as-a-multitouch-device-in-adobe-air/"},"frontmatter":{"title":"as3osceleton: Using Kinect as a multitouch device in adobe AIR","tags":["actionscript","AIR","Flash","kinect"]}},"next":{"fields":{"slug":"/2011/06/09/airserver-handling-both-sockets-websockets-in-adobe-air/"},"frontmatter":{"title":"AIRServer – handling both sockets & websockets in Adobe AIR","tags":["Actionscript 3.0","AIR","html5"]}},"tag":["Actionscript 3.0","AIR","html5"]}}}